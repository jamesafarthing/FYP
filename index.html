<!doctype html>
<html>
<head>

 <!-- <script src="canvasmath\jquery.js"></script>
  <script src="canvasmath\lib.js"></script>
  <script src="canvasmath\box.js"></script>
  <script src="canvasmath\layout.js"></script>
  <script src="canvasmath\operators.js"></script>
  <script src="canvasmath\expr.js"></script>
  <script src="canvasmath\parse.js"></script>
  <script src="canvasmath\select.js"></script>
  <script src="canvasmath\edit.js"></script>
  <script src="canvasmath\inline.js"></script>
  <style>
  .selectable {
    cursor: text; 
  }
  .editor-button {
    border: 1px solid gray;
    margin: 1px;
    background-color: white;
  }
  </style> -->

<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<!--<script type='text/javascript' src='http://mathdox.org/formulaeditor/main.js'></script> -->
<meta charset="UTF-8" />
<title>FYP!</title>
<header>
<h1> Addition and Subtraction Drag and Drop Game </h1>
</header>
</head>
<body>
<!-- $$x = {-b \pm \sqrt{b^2-4ac} \over 2a}.$$ -->
<!-- <p>This one is neither selectable nor editable: <cvm>sqrt(x^2+y^2)</cvm>!</p> -->

<!--<img id="scream" width="100" height="100" src="C:\Users\James\Pictures\james2photo.jpg" alt="The Scream"> -->
<p>Drag numbers to the bottom half to add them together (when it goes green). Drag a number of the top half of another one and it will subtract the one you are moving from the static one (when it goes red). Click create to begin. Numbers are created in order, starting with 1.</p> 
<section>

<div class = "canvasholder">
<!--<div id="latexContent">\(3 + 4 = 7\)</div> -->
<canvas id="canvas" width="700" height="700" style="border:1px solid #000000;">
This text is displayed if your browser does not support HTML5 Canvas.
</canvas>
</div>

<button onclick="create()">Create</button>
<button onclick="deleteAll()">Delete All</button>

<script type="text/javascript">

var canvas;
var ctx;
var x = 75;
var y = 50;
var number = 1;
var WIDTH = 700;
var HEIGHT = 700;
var dragok = false;
var r = [];
var move;
var border = "black";
var taken = false;

function object(x, y, w, h) {
	this.x = x;
	this.y = y;
	this.w = w;
	this.h = h;
	this.number = number++;
	this.border = border;
	this.taken = taken; 
}

function create(){
	r.push(new object(55, 55, 100, 100));
} 

function deleteAll(){
	r.splice(0,r.length);
	number = 1;
}

function rect(x,y,w,h) {
	ctx.beginPath();
	ctx.rect(x,y,w,h);
	var img = document.getElementById("scream");
    //ctx.drawImage(img, x, y, w*2, h*2);
	ctx.closePath();
	ctx.fill();
}

function clear() {
	ctx.clearRect(0, 0, WIDTH, HEIGHT);
}

function init() {

	canvas = document.getElementById("canvas");
	ctx = canvas.getContext("2d");
	return setInterval(drawIterate, 10);
}

function drawIterate() {
	clear();
	for (i = 0; i < r.length ; i++) {
		draw(r[i].x, r[i].y, r[i].w, r[i].h, i, r[i].border);
	}
}

function draw(x, y, w, h, i, border) {
	ctx.fillStyle = "#FAF7F8";
	rect(x-(w/2), y-(h/2), w, h);
	ctx.strokeStyle = border;
	ctx.stroke();
	ctx.font="32px Georgia";
	ctx.fillStyle = "#444444";
	ctx.fillText(r[i].number.toString(), x-10, y);
}

function myMove(e){
	if (dragok){
		r[move].x = e.pageX - canvas.offsetLeft;
		r[move].y = e.pageY - canvas.offsetTop;
		
		for(i = 0; i < r.length; i ++) {
			if (i != move && r[i].taken == r[move].taken &&
			(((r[i].x - (r[i].w/2)) < (r[move].x + (r[move].w/2))) && ((r[move].x - (r[move].w/2)) < (r[i].x + (r[i].w/2)))) 
			&& ((r[move].y -(r[move].h/2)) < (r[i].y + (r[i].h/2))) 
			&& ((r[move].y -(r[move].h/2)) > r[i].y)){
				r[i].border = "green";
				r[move].border = "green";
				r[i].taken = true;
				r[move].taken = true;
				break;
			}
			else if (i != move && r[i].taken == r[move].taken &&
				(((r[i].x - (r[i].w/2)) < (r[move].x + (r[move].w/2))) && ((r[move].x - (r[move].w/2)) < (r[i].x + (r[i].w/2))))
				&& ((r[move].y + (r[move].h/2)) > (r[i].y -(r[i].h/2)))
				&& ((r[move].y + (r[move].h/2)) < r[i].y)){
					r[i].border = "red";
					r[move].border = "red";
					r[i].taken = true;
					r[move].taken = true;
					break;
				}
			else if (i != move && r[i].taken == true && r[move].taken == true) {
				r[i].border = "black";
				r[move].border = "black";
				r[i].taken = false;
				r[move].taken = false;
			}
			/*else if (r[i].taken = false && r[move].taken = false)
			{
				r[i].border = "black";
				r[move].border = "black";
			}*/
		}
	}
}

function myDown(e){
	move = 0;
	for (j = 0; j < r.length; j++) {
		if (e.pageX < r[j].x + (r[j].w/2) + canvas.offsetLeft && e.pageX > r[j].x - (r[j].w/2) +
			canvas.offsetLeft && e.pageY < r[j].y + (r[j].h/2) + canvas.offsetTop &&
			e.pageY > r[j].y - (r[j].h/2) + canvas.offsetTop){
				move = j;
				r[j].x = e.pageX - canvas.offsetLeft;
				r[j].y = e.pageY - canvas.offsetTop;
				dragok = true;
				canvas.onmousemove = myMove;
		}
	}
}

function myUp(){
	dragok = false;
	canvas.onmousemove = null;
	for(i = 0; i < r.length; i ++) {
		//if (i != move && 
			//(((r[i].x - 50) < (r[move].x + 50)) && ((r[move].x - 50) < (r[i].x + 50))) 
			//&& ((r[move].y -50) < (r[i].y + 50)) 
			//&& ((r[move].y -50) > r[i].y)){
			if (i != move && r[i].border == "green" && r[i].taken == r[move].taken) {
				r[i].number = r[i].number + r[move].number;
				r[i].border = "black";
				r[i].taken = false;
				r.splice(move,1);	
		}
		//if (i != move &&
		//	(((r[i].x - 50) < (r[move].x + 50)) && ((r[move].x - 50) < (r[i].x + 50)))
		//	&& ((r[move].y + 50) > (r[i].y -50))
		//	&& ((r[move].y + 50) < r[i].y)){
			if (i != move && r[i].border == "red" && r[i].taken == r[move].taken) {
				r[i].number = r[i].number - r[move].number;
				r[i].border = "black";
				r[i].taken = false;
				r.splice(move,1);	
		}
	}
}

init();
canvas.onmousedown = myDown;
canvas.onmouseup = myUp;

</script>

</section>
</body>
</html>


<!--http://html5.litten.com/how-to-drag-and-drop-on-an-html5-canvas/-->