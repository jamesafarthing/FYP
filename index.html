<!doctype html>
<html>
<head>

<script src="https://code.createjs.com/easeljs-0.8.2.min.js"></script>
 <!-- <script src="canvasmath\jquery.js"></script>
  <script src="canvasmath\lib.js"></script>
  <script src="canvasmath\box.js"></script>
  <script src="canvasmath\layout.js"></script>
  <script src="canvasmath\operators.js"></script>
  <script src="canvasmath\expr.js"></script>
  <script src="canvasmath\parse.js"></script>
  <script src="canvasmath\select.js"></script>
  <script src="canvasmath\edit.js"></script>
  <script src="canvasmath\inline.js"></script>
  <style>
  .selectable {
    cursor: text; 
  }
  .editor-button {
    border: 1px solid gray;
    margin: 1px;
    background-color: white;
  }
  </style> -->

<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<!--<script type='text/javascript' src='http://mathdox.org/formulaeditor/main.js'></script> -->
<meta charset="UTF-8" />
<title>Natural Deduction!</title>
<header>
<h1> Natural Deduction Drag and Drop Game </h1>
</header>
</head>
<body>
<!-- $$x = {-b \pm \sqrt{b^2-4ac} \over 2a}.$$ -->
<!-- <p>This one is neither selectable nor editable: <cvm>sqrt(x^2+y^2)</cvm>!</p> -->
<section>

<div class = "canvasholder">
<div id="latexContent">\(3 + 4 = 7\)</div>
<canvas id="canvas" width="700" height="700" style="border:1px solid #000000;">
This text is displayed if your browser does not support HTML5 Canvas.
</canvas>
</div>

<button onclick="create()">Create</button>
<button onclick="deleteAll()">Delete All</button>

<script type="text/javascript">

var canvas;
var ctx;
var x = 75;
var y = 50;
var number = 1;
var WIDTH = 700;
var HEIGHT = 700;
var dragok = false;
var r = [];
var move;
var border = "black";

function object(x, y) {
	this.x = x;
	this.y = y;
	this.number = number++;
	this.border = border;
}

function create(){
	r.push(new object(55, 55));
} 

function deleteAll(){
	r.splice(0,r.length);
	number = 0;
}

function rect(x,y,w,h) {
	/*ctx.beginPath();
	ctx.rect(x,y,w,h);
	ctx.closePath();
	ctx.fill();*/
	
	var graphics = new createjs.Graphics().beginFill("#ff0000").drawRect(0, 0, 100, 100);
	var rec = new createjs.Shape(graphics);
	//rec.x = x;
	//rec.y = y;
	stage.addChild(rec);
	stage.update();
}

function clear() {
	ctx.clearRect(0, 0, WIDTH, HEIGHT);
}

function init() {
var stage = new createjs.Stage("canvas");
var domElement = new createjs.DOMElement(document.getElementById("latexContent"));
stage.addChild(domElement);
	//canvas = document.getElementById("canvas");
	//ctx = canvas.getContext("2d");
	
	//return setInterval(drawIterate, 10);
	drawIterate();
}

function drawIterate() {
	clear();
	for (i = 0; i < r.length ; i++) {
		draw(r[i].x, r[i].y, i, r[i].border);
	}
}

function draw(a, b, i, border) {
	//ctx.fillStyle = "#FAF7F8";
	rect(a - 50, b - 50, 100, 100);
	//ctx.strokeStyle = border;
	//ctx.stroke();
	//ctx.font="32px Georgia";
	//ctx.fillStyle = "#444444";
	//ctx.fillText(r[i].number.toString(), a -25, b);
	//ctx.fillText(r[i].number.toString(), a -25, b);
}

function myMove(e){
	if (dragok){
		r[move].x = e.pageX - canvas.offsetLeft;
		r[move].y = e.pageY - canvas.offsetTop;
		
		for(i = 0; i < r.length; i ++) {
			if (i != move && 
			(((r[i].x - 50) < (r[move].x + 50)) && ((r[move].x - 50) < (r[i].x + 50))) 
			&& ((r[move].y -50) < (r[i].y + 50)) 
			&& ((r[move].y -50) > r[i].y)){
				r[i].border = "green";
				r[move].border = "green";
				break;
			}
			else if (i != move &&
				(((r[i].x - 50) < (r[move].x + 50)) && ((r[move].x - 50) < (r[i].x + 50)))
				&& ((r[move].y + 50) > (r[i].y -50))
				&& ((r[move].y + 50) < r[i].y)){
					r[i].border = "red";
					r[move].border = "red";
					break;
				}
			else if (i != move) {
				r[i].border = "black";
				r[move].border = "black";
			}
		}
	}
}

function myDown(e){
	move = 0;
	for (j = 0; j < r.length; j++) {
		if (e.pageX < r[j].x + 50 + canvas.offsetLeft && e.pageX > r[j].x - 50 +
			canvas.offsetLeft && e.pageY < r[j].y + 50 + canvas.offsetTop &&
			e.pageY > r[j].y - 50 + canvas.offsetTop){
				move = j;
				r[j].x = e.pageX - canvas.offsetLeft;
				r[j].y = e.pageY - canvas.offsetTop;
				dragok = true;
				canvas.onmousemove = myMove;
		}
	}
}

function myUp(){
	dragok = false;
	canvas.onmousemove = null;
	for(i = 0; i < r.length; i ++) {
		if (i != move && 
			(((r[i].x - 50) < (r[move].x + 50)) && ((r[move].x - 50) < (r[i].x + 50))) 
			&& ((r[move].y -50) < (r[i].y + 50)) 
			&& ((r[move].y -50) > r[i].y)){
				r[i].number = r[i].number + r[move].number;
				r[i].border = "black";
				r.splice(move,1);	
		}
		if (i != move &&
			(((r[i].x - 50) < (r[move].x + 50)) && ((r[move].x - 50) < (r[i].x + 50)))
			&& ((r[move].y + 50) > (r[i].y -50))
			&& ((r[move].y + 50) < r[i].y)){
				r[i].number = r[i].number - r[move].number;
				r[i].border = "black";
				r.splice(move,1);	
		}
	}
}

init();
canvas.onmousedown = myDown;
canvas.onmouseup = myUp;

</script>

</section>
</body>
</html>


<!--http://html5.litten.com/how-to-drag-and-drop-on-an-html5-canvas/-->