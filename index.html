<!doctype html>
<html>
<head>
  
<link href='https://fonts.googleapis.com/css?family=Crimson+Text' rel='stylesheet' type='text/css'>
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<meta charset="UTF-8" />
<title>FYP!</title>
<header>
<h1> Addition and Subtraction Drag and Drop Game </h1>
</header>
</head>
<body>

<p>Drag numbers to the bottom half to add them together (when it goes green). 
Drag a number of the top half of another one and it will subtract the one you 
are moving from the static one (when it goes red). Click create to begin. 
Numbers are created in order, starting with 1.</p> 
<section>

<div class = "canvasholder">
<canvas id="canvas" width="700" height="700" style="border:1px solid #000000;">
This text is displayed if your browser does not support HTML5 Canvas.
</canvas>
</div>

<button onclick="create()">Create</button>
<button onclick="deleteAll()">Delete All</button>

<script type="text/javascript">

var canvas;
var ctx;
var x = 75;
var y = 50;
var number = 1;
var WIDTH = 700;
var HEIGHT = 700;
var dragok = false;
var r = [];
var move;
var border = "black";
var taken = false;
var texttopleft = " ";
var texttopright = " ";
var textbottom = " ";

function object(x, y, w, h, number, texttopleft, texttopright, textbottom) {
	this.x = x;
	this.y = y;
	this.w = w;
	this.h = h;
	this.number = number;
	this.border = border;
	this.taken = taken; 
	this.texttopleft = texttopleft;
	this.texttopright = texttopright;
	this.textbottom = textbottom;
}

function create(){
	//r.push(new object(55, 55, 100, 100));
	r.push(new object(55,  55,  100, 100, 1, "A", "none", "none"));
	r.push(new object(335, 55,  100, 100, 2, "B", "none", "none"));
	r.push(new object(645, 55,  100, 100, 3, "∧", "none", "none"));
	r.push(new object(355, 600, 100, 100, 4, "%",  "%",   "%"));
	r.push(new object(505, 55,  100, 100, 5, "→", "none", "none"));	
} 

function deleteAll(){
	r.splice(0,r.length);
	number = 1;
}

function rect(x,y,w,h) {
	ctx.beginPath();
	ctx.rect(x,y,w,h);
	ctx.closePath();
	ctx.fill();
}

function clear() {
	ctx.clearRect(0, 0, WIDTH, HEIGHT);
}

function init() {

	canvas = document.getElementById("canvas");
	ctx = canvas.getContext("2d");
	create();
	return setInterval(drawIterate, 10);
}

function drawIterate() {
	clear();
	for (i = 0; i < r.length ; i++) {
		draw(r[i].x, r[i].y, r[i].w, r[i].h, i, r[i].border, r[i].texttopleft, r[i].texttopright, r[i].textbottom);
	}
}

function draw(x, y, w, h, i, border, texttopleft, texttopright, textbottom) {
	ctx.fillStyle = "#FAF7F8";
	rect(x-(w/2), y-(h/2), w, h);
	ctx.strokeStyle = border;
	ctx.stroke();
	ctx.font="32px Georgia";
	ctx.fillStyle = "#444444";
	ctx.textAlign = 'center';
	if (textbottom == "none") {
		r[i].w = texttopleft.length * 50;
		r[i].h = 50;
		//ctx.fillText(texttop, x-(texttop.length*16), y);
		ctx.textAlign = "center";
		ctx. fillText(texttopleft, x, y+(h/4));
	}
	else {
		r[i].w = Math.max((texttopleft.length + texttopright.length)*50, textbottom.length * 30, 50);
		ctx.fillStyle = "#444444";
		ctx.beginPath();
		ctx.moveTo (x -((3*w)/8), y);
		ctx.lineTo( x + ((3*w)/8) , y);
		ctx.stroke();
		ctx.textAlign = 'center';
		if(texttopleft != "%") {
		ctx.fillText(texttopleft, x-(w/4), y-(h/6));		
		}
		if(texttopright != "%"){
			ctx.fillText(texttopright, x+(w/4), y-(h/6));
		}
		if(textbottom != "%") {
		ctx.fillText(textbottom, x, y+(h/3));
		}
	}
	//else{
		//ctx.fillText(texttop, x-10, y);
	//}
	//ctx.moveTo (x -((3*w)/8), y);
	//ctx.lineTo( x + ((3*w)/8) , y);
	//ctx.fillText(r[i].number.toString(), x-10, y-(h/6));
	//ctx.fillText(r[i].number.toString(), x-10, y+(h/3));
	//ctx.fillText(texttop, x-10, y-(h/6));
	//ctx.fillText(textbottom, x-10, y+(h/3));
}

function doneCheck() {
	if (r[i].texttopleft == "A" && r[i].texttopright == "B" && r[i].textbottom == "∧") {
		r[i].textbottom = "A ∧ B";
		return true;
	}
	else if (r[i].texttopleft == "B" && r[i].texttopright == "A" && r[i].textbottom == "∧") {
		r[i].textbottom = "B ∧ A";
		return true;
	}
	else {
		return false;
	}
}

function validMoveTopLeft() {
	if (r[i].number == 4) {
		if (r[move].number == 1 || r[move].number == 2) {
			if(r[i].texttopleft == "%"){
				r[i].texttopleft = r[move].texttopleft;
				r[i].border = "black";
				r[i].taken = false;
				var done = doneCheck();
				r.splice(move,1);
				if (done == true) {
					drawIterate();
					drawIterate();
					window.alert("Congratulations! Level 1 Complete.");
				}
			}
			else {
				window.alert("This is not a valid move!");
				//r[i].texttopleft = r[i].texttopleft + ", "+ r[move].texttopleft;
			}
		}
		else{
			window.alert("This is not a valid move!");
		}
	}
	else{
			window.alert("This is not a valid move!");
		}
}

function validMoveTopRight() {
	if (r[i].number == 4) {
		if (r[move].number == 1 || r[move].number == 2) {
			if(r[i].texttopright == "%"){
				r[i].texttopright = r[move].texttopleft;
				r[i].border = "black";
				r[i].taken = false;
				var done = doneCheck();
				r.splice(move,1);
				if (done == true) {
					drawIterate();
					drawIterate();					
					window.alert("Congratulations! Level 1 Complete.");
				}
			}
			else {
				window.alert("This is not a valid move!");
				//r[i].texttopright = r[i].texttopright + ", "+ r[move].texttopright;
			}
		}
		else{
			window.alert("This is not a valid move!");
		}
	}
	else{
			window.alert("This is not a valid move!");
		}
}

function validMoveBottom() {
	if (r[i].number == 4) {
		if (r[move].number == 3) {
			r[i].textbottom = r[move].texttopleft;
			r[i].border = "black";
			r[i].taken = false;
			var done = doneCheck();
			r.splice(move,1);
			if (done == true) {
				drawIterate();
				drawIterate();
				window.alert("Congratulations! Level 1 Complete.");
			}
		}
		else {
			window.alert("This is not a valid move!");
		}
	}
	else {
		window.alert("This is not a valid move!");
	}
}

function myMove(e){
	if (dragok){
		r[move].x = e.pageX - canvas.offsetLeft;
		r[move].y = e.pageY - canvas.offsetTop;
		
		for(i = 0; i < r.length; i ++) {
			if (i != move && r[i].taken == r[move].taken &&
			(((r[i].x - (r[i].w/2)) < (r[move].x + (r[move].w/2))) && ((r[move].x - (r[move].w/2)) < (r[i].x + (r[i].w/2)))) 
			&& ((r[move].y -(r[move].h/2)) < (r[i].y + (r[i].h/2))) 
			&& ((r[move].y -(r[move].h/2)) > r[i].y)){
				r[i].border = "green";
				r[move].border = "green";
				r[i].taken = true;
				r[move].taken = true;
				break;
			}
			else if (i != move && r[i].taken == r[move].taken &&
				((r[i].x < r[move].x) && ((r[move].x - (r[move].w/2)) < (r[i].x + (r[i].w/2))))
				&& ((r[move].y + (r[move].h/2)) > (r[i].y -(r[i].h/2)))
				&& ((r[move].y + (r[move].h/2)) < r[i].y)){
					r[i].border = "red";
					r[move].border = "red";
					r[i].taken = true;
					r[move].taken = true;
					break;
			}
			else if (i != move && r[i].taken == r[move].taken &&
				(((r[i].x - (r[i].w/2)) < (r[move].x + (r[move].w/2))) && ((r[move].x - (r[move].w/2)) < r[i].x))
				&& ((r[move].y + (r[move].h/2)) > (r[i].y -(r[i].h/2)))
				&& ((r[move].y + (r[move].h/2)) < r[i].y)){
					r[i].border = "yellow";
					r[move].border = "yellow";
					r[i].taken = true;
					r[move].taken = true;
					break;
			}
			else if (i != move && r[i].taken == true && r[move].taken == true) {
				r[i].border = "black";
				r[move].border = "black";
				r[i].taken = false;
				r[move].taken = false;
			}
		}
	}
}

function myDown(e){
	move = 0;
	for (j = 0; j < r.length; j++) {
		if (e.pageX < r[j].x + (r[j].w/2) + canvas.offsetLeft && e.pageX > r[j].x - (r[j].w/2) +
			canvas.offsetLeft && e.pageY < r[j].y + (r[j].h/2) + canvas.offsetTop &&
			e.pageY > r[j].y - (r[j].h/2) + canvas.offsetTop){
				move = j;
				r[j].x = e.pageX - canvas.offsetLeft;
				r[j].y = e.pageY - canvas.offsetTop;
				dragok = true;
				canvas.onmousemove = myMove;
		}
	}
}

function myUp(){
	dragok = false;
	canvas.onmousemove = null;
	for(i = 0; i < r.length; i ++) {
		//if (i != move && 
			//(((r[i].x - 50) < (r[move].x + 50)) && ((r[move].x - 50) < (r[i].x + 50))) 
			//&& ((r[move].y -50) < (r[i].y + 50)) 
			//&& ((r[move].y -50) > r[i].y)){
		if (i != move && r[i].border == "green" && r[i].taken == r[move].taken) {
				//r[i].number = r[i].number + r[move].number;
				//r[i].border = "black";
				//r[i].taken = false;
				//r.splice(move,1);	
				validMoveBottom();
		}
		//if (i != move &&
		//	(((r[i].x - 50) < (r[move].x + 50)) && ((r[move].x - 50) < (r[i].x + 50)))
		//	&& ((r[move].y + 50) > (r[i].y -50))
		//	&& ((r[move].y + 50) < r[i].y)){
		if (i != move && r[i].border == "red" && r[i].taken == r[move].taken) {
				//r[i].number = r[i].number - r[move].number;
				//r[i].border = "black";
				//r[i].taken = false;
				//r.splice(move,1);
			validMoveTopRight();
		}
		if (i != move && r[i].border == "yellow" && r[i].taken == r[move].taken) {
			validMoveTopLeft();
		}
		
	}
}


init();
canvas.onmousedown = myDown;
canvas.onmouseup = myUp;

</script>

</section>
</body>
</html>


<!--http://html5.litten.com/how-to-drag-and-drop-on-an-html5-canvas/-->