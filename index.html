<!doctype html>
<html>
<head>
<link href='https://fonts.googleapis.com/css?family=Crimson+Text' rel='stylesheet' type='text/css'>
<meta charset="UTF-8" />
<title>FYP!</title>
<header>
<h1> Natural Deduction Drag and Drop Game </h1>
</header>
</head>
<body>
<!-- <img id="bin" width="220" height="277" src="bin.jpg" alt="bin"> -->

<p>The goal is to create A and B.</p> 
<section>

<div class = "canvasholder">
<canvas id="canvas" width="700" height="700" style="border:1px solid #000000;">
This text is displayed if your browser does not support HTML5 Canvas.
</canvas>
</div>

<button onclick="createTwoUpOneDown()">2 Top / 1 Bottom</button>
<button onclick="createTwoUpTwoDown()">2 Top / 2 Bottom</button>
<button onclick="createOneUpTwoDown()">1 Top / 2 Bottom</button>

<button onclick="createA()">A</button>
<button onclick="createB()">B</button>
<button onclick="createC()">C</button>

<button onclick="createConjunction()">∧</button>
<button onclick="createImplication()">→</button>

<button onclick="deleteAll()">Delete All</button>

<img id="bin" width="0" height="0" src="bin.jpg" alt="bin" style="visibility:hidden"> 

<script type="text/javascript">

var canvas;
var ctx;
var x = 75;
var y = 50;
var WIDTH = 700;
var HEIGHT = 700;
var dragok = false;
var r = [];
var move;
var border = "black";
var taken = false;
var text = [];
var type = 0; //0 is variable, 1 is operator, 2, 3, 4 are forms

function object(x, y, w, h, text, type) {
	this.x = x;
	this.y = y;
	this.w = w;
	this.h = h;
	this.border = border;
	this.taken = taken;
	this.text = text;
	this.type = type;
}

function createTwoUpOneDown(){
	r.push(new object(355, 600, 100, 100, ["%", "%", "%", "%"], 2));
} 
function createTwoUpTwoDown() {
	r.push(new object(355, 500, 100, 100, ["%", "%", "%", "%"], 3));
}
function createOneUpTwoDown() {
	r.push(new object(355, 500, 100, 100, ["%", "%", "%", "%"], 4));
}
function createA(){
	r.push(new object(55,  55,  100, 100, ["A", "none", "none", "none"], 0));
} 

function createB(){
	r.push(new object(335, 55,  100, 100, ["B", "none", "none", "none"], 0));
} 

function createC(){
	r.push(new object(195, 55,  100, 100, ["C", "none", "none", "none"], 0));
} 

function createConjunction(){
	r.push(new object(645, 55,  100, 100, ["∧", "none", "none", "none"], 1));
}

function createImplication(){
	r.push(new object(505, 55,  100, 100, ["→", "none", "none", "none"], 1));
}


function deleteAll(){
	r.splice(0,r.length);
}

function rect(x,y,w,h) {
	ctx.beginPath();
	ctx.rect(x,y,w,h);
	ctx.closePath();
	ctx.fill();
}

function clear() {
	ctx.clearRect(0, 0, WIDTH, HEIGHT);
}

function init() {

	canvas = document.getElementById("canvas");
	ctx = canvas.getContext("2d");
	return setInterval(drawIterate, 10);
}

function drawIterate() {
	clear();
	var bin = document.getElementById("bin");
    ctx.drawImage(bin, 590, 562, 110, 138); 
	for (i = 0; i < r.length ; i++) {
		draw(r[i].x, r[i].y, r[i].w, r[i].h, i, r[i].border, r[i].text);
	}
}

function draw(x, y, w, h, i, border, text) {
	ctx.fillStyle = "#FAF7F8";
	rect(x-(w/2), y-(h/2), w, h);
	ctx.strokeStyle = border;
	ctx.lineWidth=3;
	ctx.stroke();
	ctx.font="32px Georgia";
	ctx.fillStyle = "#444444";
	ctx.textAlign = 'center';
	if (text[2] == "none") { //Figures out whether it is a form or a var/operator.
		r[i].w = Math.max(50, text[0].length * 30);
		r[i].h = 50;
		ctx.textAlign = "center";
		ctx. fillText(text[0], x, y+(h/4));
	}
	else {
		r[i].w = Math.max((text[0].length + text[1].length)*40, (text[2].length + text[3].length)*40, 100); //Sets box size
		ctx.fillStyle = "#444444";
		ctx.beginPath();
		ctx.strokeStyle = "black";
		ctx.moveTo (x -((3*w)/8), y);
		ctx.lineTo( x + ((3*w)/8) , y); //Draws middle line for the proof
		ctx.stroke();
		
		ctx.textAlign = 'center'; //Draws text in the various boxes in the correct positions.
		if(text[0] != "%" && r[i].type != 4) {
		ctx.fillText(text[0], x-(w/4), y-(h/6));		
		} else if (text[0] != "%") {
			ctx.fillText(text[0], x, y-(h/6));
		}
		
		if(text[1] != "%"){
			ctx.fillText(text[1], x+(w/4), y-(h/6));
		}
		
		if(text[2] != "%" && r[i].type != 2) {
			ctx.fillText(text[2], x-(w/4), y+(h/3));
		} else if (text[2] != "%"){
			ctx.fillText(text[2], x, y+(h/3));
		}
		
		if(text[3] != "%") {
			ctx.fillText(text[3], x+(w/4), y+(h/3));
		}
	}
}

function doneCheck() { //Checks to see if the code is correct and fill it in.
	if (r[i].text[0] == "A" && r[i].text[1] == "B" && r[i].text[2] == "∧") {
		r[i].text[2] = "A ∧ B";
		return true;
	}
	else if (r[i].text[0] == "B" && r[i].text[1] == "A" && r[i].text[2] == "∧") {
		r[i].text[2] = "B ∧ A";
		return true;
	}
	else {
		return false;
	}
}

function delShape(i, move) {
	r[i].border = "black";
	r[i].taken = false;
	var done = doneCheck();
	r.splice(move,1);
	if (done == true) {
		drawIterate();
		drawIterate();
		window.alert("Congratulations! Level 1 Complete.");
	}
}

function validMoveTopLeft() {
	if (r[i].type == 1 || r[i].type == 0) {
		r[i].text[0] = r[move].text[0] + " " + r[i].text[0];
		delShape(i, move);
	}
	else if (r[i].type == 2 || r[i].type == 3 || r[i].type == 4) {
		if (r[move].type == 2){
			r[i].text[0] = r[move].text[2];
			delShape(i, move);
		}
		else if (r[move].type == 1 || r[move].type == 0) {
			if (r[i].text[0] == "%"){
				r[i].text[0] = r[move].text[0];
				delShape(i, move);
			}
			else {
				r[i].text[0] = r[i].text[0] + " " + r[move].text[0];
				delShape(i, move);
			}
		}
		else {
			window.alert("This is not a valid move!");
		}
	}
	else {
		window.alert("This is not a valid move!");
	}
}

function validMoveTopRight() {
	if (r[i].type == 1 || r[i].type == 0) {
		r[i].text[0] = r[i].text[0] + " " + r[move].text[0];
		delShape(i, move);
	}
	else if (r[i].type == 2 || r[i].type == 3) {
		if(r[move].type == 2) {
			r[i].text[1] = r[move].text[2];
			delShape(i, move);
		}
		else if (r[move].type == 1 || r[move].type == 0) {
			if(r[i].text[1] == "%"){
				r[i].text[1] = r[move].text[0];
				delShape(i, move);
			}
			else {
				r[i].text[1] = r[i].text[1] + " " + r[move].text[0];
				delShape(i, move);
			}
		}
		else {
			window.alert("This is not a valid move!");
		}
	}
	else if (r[i].type == 4) {
		if(r[move].type == 2) {
			r[i].text[0] = r[move].text[2];
			delShape(i, move);
		}
		else if (r[move].type == 1 || r[move].type == 0) {
			if(r[i].text[0] == "%"){
				r[i].text[0] = r[move].text[0];
				delShape(i, move);
			}
			else {
				r[i].text[0] = r[i].text[0] + " " + r[move].text[0];
				delShape(i, move);
			}
		}
		else {
			window.alert("This is not a valid move!");
		}
	}
	else {
		window.alert("This is not a valid move!");
	}
}

function validMoveBottomLeft() {
	if (r[i].type == 2 || r[i].type == 3 || r[i].type == 4) {
		if(r[move].type == 4) {
			r[i].text[2] = r[move].text[0];
			delShape(i, move);
		}
		else if (r[move].type == 1 || r[move].type == 0) {
			if (r[i].text[2] == "%") {
				r[i].text[2] = r[move].text[0];
				delShape(i, move);
			}
			else {
				r[i].text[2] = r[i].text[2] + " " + r[move].text[0];
				delShape(i, move);
			}
		}
		else {
			window.alert("This is not a valid move!");
		}
	}
	else {
		window.alert("This is not a valid move!");
	}
}

function validMoveBottomRight() {
	if (r[i].type == 2) {
		if(r[move].type == 4) {
			r[i].text[2] = r[move].text[0];
			delShape(i, move);			
		}
		else if (r[move].type == 1 || r[move].type == 0) {
			if (r[i].text[2] == "%") {
				r[i].text[2] = r[move].text[0];
				delShape(i, move);
			}
			else {
				r[i].text[2] = r[i].text[2] + " " + r[move].text[0];
				delShape(i, move);
			}
		}
	}
	else if (r[i].type == 3 || r[i].type == 4) {
		if(r[move].type == 4) {
			r[i].text[3] = r[move].text[0];
			delShape(i, move);			
		}
		else if (r[move].type == 1 || r[move].type == 0) {
			if (r[i].text[3] == "%") {
				r[i].text[3] = r[move].text[0];
				delShape(i, move);
			}
			else {
				r[i].text[3] = r[i].text[3] + " " + r[move].text[0];
				delShape(i, move);
			}
		}
		else {
			window.alert("This is not a valid move!");
		}
	}
	else {
		window.alert("This is not a valid move!");
	}
}

function myMove(e){ //Runs when an object is being moved
	if (dragok){
		r[move].x = e.pageX - canvas.offsetLeft;
		r[move].y = e.pageY - canvas.offsetTop;
		
		for(i = 0; i < r.length; i ++) { //Cycle through static elements
			
			if (i != move && r[i].taken == r[move].taken && //Move over bottom left
			(((r[i].x - (r[i].w/2)) < (r[move].x + (r[move].w/2))) && ((r[move].x) < r[i].x)) 
			&& ((r[move].y -(r[move].h/2)) < (r[i].y + (r[i].h/2))) 
			&& ((r[move].y -(r[move].h/2)) >= r[i].y - (r[i].h/2))){
			
				if (r[i].type == 0 || r[i].type == 1) {
					r[i].border = "green";
					r[move].border = "green";
					r[i].taken = true;
					r[move].taken = true;
					break;
				}
				else if (r[i].type == 2) {
					r[i].border = "LightBlue";
					r[move].border = "LightBlue";
					r[i].taken = true;
					r[move].taken = true;
					break;
				}
				else if (r[i].type == 3 || r[i].type == 4) {
					r[i].border = "olive";
					r[move].border = "olive";
					r[i].taken = true;
					r[move].taken = true;
					break;
				}
			}
			else if (i != move && r[i].taken == r[move].taken && //Move over bottom right
			((r[i].x < (r[move].x + (r[move].w/2))) && ((r[move].x - (r[move].w/2)) < (r[i].x + (r[i].w/2)))) 
			&& ((r[move].y -(r[move].h/2)) < (r[i].y + (r[i].h/2))) 
			&& ((r[move].y -(r[move].h/2)) >= r[i].y - (r[i].h/2))){
			
				if (r[i].type == 0 || r[i].type == 1) {
					r[i].border = "red";
					r[move].border = "red";
					r[i].taken = true;
					r[move].taken = true;
					break;
				}
				else if (r[i].type == 2 || r[i].type == 3 || r[i].type ==4) {
					r[i].border = "LightBlue";
					r[move].border = "LightBlue";
					r[i].taken = true;
					r[move].taken = true;
					break;
				}
			}
			else if (i != move && r[i].taken == r[move].taken && //Move over top right
				((r[i].x < r[move].x) && ((r[move].x - (r[move].w/2)) < (r[i].x + (r[i].w/2))))
				&& ((r[move].y + (r[move].h/2)) > (r[i].y -(r[i].h/2)))
				&& ((r[move].y + (r[move].h/2)) <= r[i].y + (r[i].h/2))){
				
				if (r[i].type == 0 || r[i].type == 1) {
					r[i].border = "red";
					r[move].border = "red";
					r[i].taken = true;
					r[move].taken = true;
					break;
				}
				else if (r[i].type == 2 || r[i].type == 3) {
					r[i].border = "deeppink";
					r[move].border = "deeppink";
					r[i].taken = true;
					r[move].taken = true;
					break;
				}
				else if (r[i].type == 4) {
					r[i].border = "yellow";
					r[move].border = "yellow";
					r[i].taken = true;
					r[move].taken = true;
					break;
				}
			}
			else if (i != move && r[i].taken == r[move].taken && //Move over top left
				(((r[i].x - (r[i].w/2)) < (r[move].x + (r[move].w/2))) && ((r[move].x - (r[move].w/2)) < r[i].x))
				&& ((r[move].y + (r[move].h/2)) > (r[i].y -(r[i].h/2)))
				&& ((r[move].y + (r[move].h/2)) <= r[i].y + (r[i].h/2))){
				
				if (r[i].type == 0 || r[i].type == 1) {
					r[i].border = "green";
					r[move].border = "green";
					r[i].taken = true;
					r[move].taken = true;
					break;
				}
				else if (r[i].type == 2 || r[i].type == 3 || r[i].type == 4) {
					r[i].border = "yellow";
					r[move].border = "yellow";
					r[i].taken = true;
					r[move].taken = true;
					break;
				}
			}
			else if (i != move && r[i].taken == true && r[move].taken == true) { //If it over none of the squares
				r[i].border = "black";
				r[move].border = "black";
				r[i].taken = false;
				r[move].taken = false;
			}
				
			if (r[move].x + (r[move].w/2) >= 590 && r[move].y + (r[move].h/2) >= 562) {
				r[move].border = "Navy";
			}
			else {
				r[move].border = "black";
			}
		}
	}
}

function myDown(e){ //When the mouse is pressed down
	move = 0;
	for (j = 0; j < r.length; j++) { //Discovers which item is pressed down.
		if (e.pageX < r[j].x + (r[j].w/2) + canvas.offsetLeft && e.pageX > r[j].x - (r[j].w/2) +
			canvas.offsetLeft && e.pageY < r[j].y + (r[j].h/2) + canvas.offsetTop &&
			e.pageY > r[j].y - (r[j].h/2) + canvas.offsetTop){
				move = j;
				r[j].x = e.pageX - canvas.offsetLeft;
				r[j].y = e.pageY - canvas.offsetTop;
				dragok = true;
				canvas.onmousemove = myMove;
		}
	}
}

function myUp(){ //When the mouse is released.
	dragok = false;
	canvas.onmousemove = null;
	for(i = 0; i < r.length; i ++) { //Checking which two elements should be joined or if bin is selected
		if (i != move && r[i].border == "green" && r[i].taken == r[move].taken) {
			validMoveTopLeft();
		}if (i != move && r[i].border == "LightBlue" && r[i].taken == r[move].taken) {
			validMoveBottomRight();
		}if (i != move && r[i].border == "red" && r[i].taken == r[move].taken) {
			validMoveTopRight();
		}if (i != move && r[i].border == "yellow" && r[i].taken == r[move].taken) {
			validMoveTopLeft();
		}if (i != move && r[i].border == "deeppink" && r[i].taken == r[move].taken) {
			validMoveTopRight();
		}if (i != move && r[i].border == "olive" && r[i].taken == r[move].taken) {
			validMoveBottomLeft();
		}if (r[move].border == "Navy") {
			r.splice(move,1);
		}
	}
}


init();
canvas.onmousedown = myDown;
canvas.onmouseup = myUp;

</script>

</section>
</body>
</html>


<!--http://html5.litten.com/how-to-drag-and-drop-on-an-html5-canvas/-->